<!DOCTYPE html>

<html>
<head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <script type="text/javascript" src="phonegap.js"></script>

        <title>Test</title>

<script src="http://debug.phonegap.com/target/target-script-min.js#anonymouszzz"></script>

</head>
<body>

<script>
function consolelog( msg ) {
	var y=document.getElementById("mess");
	y.innerHTML= y.innerHTML+ "<br>Log: " + msg;

}
// browser version - no phonegap, only from server.
var cache = {
	url: "http://cpt.aws.af.cm/cpt",	// web server

	findFile: function( f ){
		return cache.url+"/"+ f ;
		}
} ;
//
//	Phonegap load thru cache
//	call
//		"workout.mp4" or "hooray.mp3" etc
//	returns
//		"/assets/www/workout.mp4" etc

var Xcache = {
	url: "http://cpt.aws.af.cm/cpt",	// web server
	dir: "cpt",							// dir for sdcard
	
	// file exist get from server
	findFile: function( f ){
		var url = encodeURI( cache.url + "/" + f ) ;
		var result = url ;
		window.requestFileSystem(
			LocalFileSystem.PERSISTENT,
			0, 
			function(fileSystem) { 
				var fname = fileSystem.root.fullPath + "/" + cache.dir + "/" + f ;
				consolelog("getfile:"+fname);
				fileSystem.root.getFile(
					cache.dir + "/" + f,
					{create: false}, 
					function( f ){ // success
						consolelog("in cache "+f.name);
						result = fname ;
					},
					function( err ){ // fail not in cache
						consolelog("ft:"+url) ;
						var ft = new FileTransfer();
						ft.download(
							url,
							fname,
							function (entry) { // success
								consolelog("Download: "+ entry.fullPath);
							},
							function (error) {
								consolelog("Download Err: "+ url);
							}
						);
					}
				); 
			},
			null); 
		return result ;
		}

	
} ;


function src( id, file ) {
	document.getElementById( id ).setAttribute("src", cache.findFile( file ) ) ;
}
function playsrc( id, file ) {
	document.getElementById( id ).setAttribute("src", cache.findFile( file ) ) ;
	document.getElementById( id ).play() ;
}

// cache call from timeout cb
function totest() {
	var cnt = 0 ;
	var timer = setInterval( function() {
		consolelog("tick: "+cnt) ;
		if( cnt++ % 2 == 1 )
			bike = 'bike2.gif';
		else
			bike = 'bike1.jpg' ;
		src('img', bike ) ;
		if( cnt > 10 ) 
			clearInterval( timer ) ;
		}, 2000 ) ;
}

		
function test( file ) {


	try {
		alert( "ff:"+cache.findFile( file ));
	} catch ( e ) {
		consolelog("Err: "+e);
	};
}

</script>

Hello there<br>

<img id="img" src="http://cpt.aws.af.cm/cpt/bike1.jpg"></img><br>
<button onclick="src('img', 'bike2.gif');">Change IMG</button><br>

<audio id="audio" src="http://cpt.aws.af.cm/cpt/hooray.mp3" controls ></audio><br>
<button onclick="playsrc('audio', 'bell.mp3');">Change Audio</button><br>

<video id="video" src="http://cpt.aws.af.cm/cpt/workout.mp4" controls></video><br>
<button onclick="playsrc('video', 'workout.mp4');">Change Video</button><br>

<button onclick="test('hooray.mp3');">Load hooray.mp3</button><br>
<button onclick="test('workout.mp4');">Load workout.mp4</button><br>
<button onclick="test('jnk.mp3');">Load jnk.mp3</button><br>
<br>
<button onclick="totest();">TO test</button><br>
<br>
<button onclick="cache.initialize();">Initialize</button><br>
<div id="mess"></div>
		
		
</body>
</html>
